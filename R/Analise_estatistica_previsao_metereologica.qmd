---
title: "Análise de Dados de Culturas"
author: "Jonas Silva, João Severo e Renan Francisco"
output: html_document, pdf_document
---

## Introdução

Este relatório apresenta a análise de dados das culturas de soja e milho, incluindo informações sobre áreas, densidade de semeadura, produtividade e insumos utilizados.

### Carregar os pacotes JSON e DPLYR

```{r}
library(jsonlite)
library(dplyr)
library(ggplot2)
```

### Carregar os dados JSON

```{r}
dados <- fromJSON("../data/dados.json")
```

### Converter dados de produtividade em NA

```{r}
dados <- dados %>%
  mutate(produtividade = as.numeric(produtividade))
```

### Visualizar os dados

```{r, echo=FALSE, results='hide'}
head(dados)
```

## Estatísticas Básicas:

### Filtrar dados relevantes

```{r}
dados_soja <- dados %>% filter(cultura == "soja")
dados_milho <- dados %>% filter(cultura == "milho")
```

```{r, echo=FALSE, results='hide'}
head(dados_soja)
```

```{r, echo=FALSE, results='hide'}
head(dados_milho)
```

### Calcular as médias de área e produtividade

```{r}
media_area_soja <- mean(dados_soja$area, na.rm = TRUE)

media_produtividade_soja <- mean(as.numeric(dados_soja$produtividade), na.rm = TRUE)

media_area_milho <- mean(dados_milho$area, na.rm = TRUE)

media_produtividade_milho <- mean(as.numeric(dados_milho$produtividade), na.rm = TRUE)
```

### Exibir Médias

```{r}
cat("Média da área de soja:",media_area_soja," ha\n")
cat("Média da produtividade de soja:",media_produtividade_soja," sc/ha\n")
cat("Média da área de milho:",media_area_milho," ha\n")
cat("Média da produtividade de milho:",media_produtividade_milho," sc/ha\n")
```

### Calcular os desvios de área e produtividade

```{r}
desvio_area_soja <- sd(dados_soja$area, na.rm = TRUE)
desvio_produtividade_soja <- sd(as.numeric(dados_soja$produtividade), na.rm = TRUE)

desvio_area_milho <- sd(dados_milho$area, na.rm = TRUE)

desvio_produtividade_milho <- sd(as.numeric(dados_milho$produtividade), na.rm = TRUE)
```

### Exibir Desvios

```{r}
cat("Desvio padrão da área de soja:",desvio_area_soja,"\n")
cat("Desvio padrão da produtividade de soja:",desvio_produtividade_soja,"\n")
cat("Desvio padrão da área de milho:",desvio_area_milho,"\n")
cat("Desvio padrão da produtividade de milho:",desvio_produtividade_milho,"\n")
```

### Calcular as médias de insumos para Soja

```{r}
media_fungicida_ha_soja <- mean(dados_soja$insumos$fungicida$fungicida_ha, na.rm = TRUE)
media_total_fungicida_soja <- mean(dados_soja$insumos$fungicida$total_fungicida, na.rm = TRUE)
media_p2o5_soja <- mean(dados_soja$insumos$adubacao$p2o5_total, na.rm = TRUE)
media_k2o_soja <- mean(dados_soja$insumos$adubacao$k2o_total, na.rm = TRUE)
```

### Calcular as médias de insumos para Milho

```{r}
media_fungicida_ha_milho <- mean(dados_milho$insumos$fungicida$fungicida_ha, na.rm = TRUE)
media_total_fungicida_milho <- mean(dados_milho$insumos$fungicida$total_fungicida, na.rm = TRUE)
media_nitrogenio_milho <- mean(dados_milho$insumos$adubacao$nitrogênio, na.rm = TRUE)
media_fosforo_milho <- mean(dados_milho$insumos$adubacao$fósforo, na.rm = TRUE)
media_potassio_milho <- mean(dados_milho$insumos$adubacao$potássio, na.rm = TRUE)
```

### Exibir Médias dos Insumos

```{r}
cat("\n### Médias dos Insumos - Soja ###\n")
cat("Média de fungicida aplicado por hectare:", media_fungicida_ha_soja, "L/ha\n")
cat("Média total de fungicida aplicado:", media_total_fungicida_soja, "L\n")
cat("Média total de P2O5 aplicado:", media_p2o5_soja, "kg/ha\n")
cat("Média total de K2O aplicado:", media_k2o_soja, "kg/ha\n")

cat("\n### Médias dos Insumos - Milho ###\n")
cat("Média de fungicida aplicado por hectare:", media_fungicida_ha_milho, "L/ha\n")
cat("Média total de fungicida aplicado:", media_total_fungicida_milho, "L\n")
cat("Média de Nitrogênio aplicado:", media_nitrogenio_milho, "kg/ha\n")
cat("Média de Fósforo aplicado:", media_fosforo_milho, "kg/ha\n")
cat("Média de Potássio aplicado:", media_potassio_milho, "kg/ha\n")

```

### Calcular desvio insumos

```{r}
# Desvio padrão para milho
desvio_fungicida_ha_milho <- sd(dados_milho$insumos$fungicida$fungicida_ha, na.rm = TRUE)
desvio_total_fungicida_milho <- sd(dados_milho$insumos$fungicida$total_fungicida, na.rm = TRUE)
desvio_nitrogenio_milho <- sd(dados_milho$insumos$adubacao$nitrogênio, na.rm = TRUE)
desvio_fosforo_milho <- sd(dados_milho$insumos$adubacao$fósforo, na.rm = TRUE)
desvio_potassio_milho <- sd(dados_milho$insumos$adubacao$potássio, na.rm = TRUE)

# Desvio padrão para soja
desvio_fungicida_ha_soja <- sd(dados_soja$insumos$fungicida$fungicida_ha, na.rm = TRUE)
desvio_total_fungicida_soja <- sd(dados_soja$insumos$fungicida$total_fungicida, na.rm = TRUE)
desvio_p2o5_soja <- sd(dados_soja$insumos$adubacao$p2o5_total, na.rm = TRUE)
desvio_k2o_soja <- sd(dados_soja$insumos$adubacao$k2o_total, na.rm = TRUE)
```

```{r}
cat("\n### Desvio Padrão dos Insumos - Soja ###\n")
cat("Desvio padrão de fungicida aplicado por hectare:", desvio_fungicida_ha_soja, "L/ha\n")
cat("Desvio padrão total de fungicida aplicado:", desvio_total_fungicida_soja, "L\n")
cat("Desvio padrão total de P2O5 aplicado:", desvio_p2o5_soja, "kg/ha\n")
cat("Desvio padrão total de K2O aplicado:", desvio_k2o_soja, "kg/ha\n")

cat("\n### Desvio Padrão dos Insumos - Milho ###\n")
cat("Desvio padrão de fungicida aplicado por hectare:", desvio_fungicida_ha_milho, "L/ha\n")
cat("Desvio padrão total de fungicida aplicado:", desvio_total_fungicida_milho, "L\n")
cat("Desvio padrão de Nitrogênio aplicado:", desvio_nitrogenio_milho, "kg/ha\n")
cat("Desvio padrão de Fósforo aplicado:", desvio_fosforo_milho, "kg/ha\n")
cat("Desvio padrão de Potássio aplicado:", desvio_potassio_milho, "kg/ha\n")

```

### dataframe para facilitar a plotagem

```{r}
df_medias <- data.frame(
  Cultura = c("Soja", "Soja", "Milho", "Milho"),
  Métrica = c("Área", "Produtividade", "Área", "Produtividade"),
  Valor = c(media_area_soja, media_produtividade_soja, media_area_milho, media_produtividade_milho)
)
```

### Gráfico de barras

```{r}
ggplot(df_medias, aes(x = Cultura, y = Valor, fill = Métrica)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Médias de Área e Produtividade", y = "Valor", x = "Cultura") +
  theme_minimal()
```

### Distribuição por Produtividade

```{r}
ggplot(dados %>% filter(!is.na(produtividade)), aes(x = cultura, y = produtividade, fill = cultura)) +
  geom_boxplot() +
  labs(title = "Distribuição da Produtividade por Cultura", y = "Produtividade (ton/ha)", x = "Cultura") +
  theme_minimal()
```

```{r}
df_insumos <- data.frame(
  Cultura = c(rep("Soja", 4), rep("Milho", 5)),  # Soja tem 4 insumos, Milho tem 5
  Insumo = c("Fungicida/ha", "Total Fungicida", "P2O5", "K2O",
             "Fungicida/ha", "Total Fungicida", "Nitrogênio", "Fósforo", "Potássio"),
  Valor = c(media_fungicida_ha_soja, media_total_fungicida_soja, media_p2o5_soja, media_k2o_soja,
            media_fungicida_ha_milho, media_total_fungicida_milho, media_nitrogenio_milho, media_fosforo_milho, media_potassio_milho)
)

```

### Média para insumos aplicados nas culturas

```{r}
ggplot(df_insumos, aes(x = Insumo, y = Valor, fill = Cultura)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Médias dos Insumos Aplicados", y = "Quantidade", x = "Tipo de Insumo") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### API meteorológica pública para coletar dados climáticos

Instalar e carregar o pacote openmeteo (se necessário)

```{r}

if (!require(openmeteo)) install.packages("openmeteo", dependencies = TRUE)
library(openmeteo)
```

Definir a cidade desejada

```{r}
cidade <- "São Paulo"
```

```{r,echo=FALSE, results='hide'}
head(cidade)
```

Obter o clima atual

```{r}
clima_atual <- weather_now(cidade)
```

```{r, echo=FALSE, results='hide'}
head(clima_atual)
```

Obter previsão para os próximos dias

```{r}

previsao <- weather_forecast(cidade,
                             daily = c("temperature_2m_max", "temperature_2m_min",
                                       "precipitation_sum", "wind_speed_10m_max",
                                       "sunshine_duration", "relative_humidity_2m_max"),
                             timezone = "America/Sao_Paulo")

```

```{r, echo=FALSE, results='hide'}
head(previsao)
```

Extrair informações do clima atual

```{r}
weather_dict <- c("Céu limpo", "Predominantemente ensolarado", "Parcialmente nublado", "Nublado")
temperatura <- clima_atual$temperature
vento <- clima_atual$windspeed
condicao <- clima_atual$weathercode
descricao_clima <- weather_dict[condicao + 1]
```

Exibir informações do clima atual

```{r}
cat("\n===== Clima Atual em", cidade, "=====\n")
cat(" Temperatura:", temperatura, "°C\n")
cat(" Velocidade do Vento:", vento, "km/h\n")
cat(" Condição Climática:", descricao_clima, "\n")
```

Exibir informações da previsão nos proximos 6 dias

```{r}
previsao_6dias <- previsao[1:6, ]
```

```{r}
# Exibir previsão formatada
cat("\n### Previsão do Tempo para os Próximos 6 Dias ###\n")

for (i in 1:nrow(previsao_6dias)) {
  cat("\nData:", format(as.Date(previsao_6dias$date[i]), "%d/%m/%Y"), "\n")
  cat(" Temp. Máx:", previsao_6dias$daily_temperature_2m_max[i], "°C\n")
  cat(" Temp. Mín:", previsao_6dias$daily_temperature_2m_min[i], "°C\n")
  cat(" Precipitação:", previsao_6dias$daily_precipitation_sum[i], "mm\n")
  cat("Vento Máx:", previsao_6dias$daily_wind_speed_10m_max[i], "km/h\n")
  cat("Duração do Sol:", round((previsao_6dias$daily_sunshine_duration[i]/3600),2), "horas\n")
  cat("Umidade Máx:", previsao_6dias$daily_relative_humidity_2m_max[i], "%\n")
  cat("------------------------\n")
} 
```
